define(["jquery","core/log","core/ajax","core/templates","core/str","core/modal_factory","core/modal_events"],function(e,s,r,o,t,a,n){"use strict";var l="#form-",i="",d="#form-alert",c="alert-success",u="alert-danger";function f(e){try{var s=JSON.parse(e);return JSON.stringify(s,null,2)}catch(r){return e}}function p(s){e(d).hasClass(c)&&e(d).removeClass(c),e(d).hasClass(u)||e(d).addClass(u),e(d).text(s),e(d).show()}function m(){document.getElementById("overlay").style.display="none"}function g(s){var o,t,n,g=e(s.target).parents(".error-summary-tr"),y=g.find(".id").text(),v={type:a.types.SAVE_CANCEL,title:"Edit uPlanner log "+y,body:'<style>.form-group { margin-bottom: 15px; }label { display: inline-block; margin-bottom: 5px; }textarea, input[type="text"] { width: 100%; padding: 8px; box-sizing: border-box; }#form-alert { display: none; }.alert { position: relative; padding: .75rem 1.25rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .25rem;.alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }.alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }</style><div id="form-alert" class="alert" role="alert"></div><form id="form-'+i+'">   <input type="hidden" id="type" name="type" value="'+i+'" readonly><div class="form-group">   <label for="id">Id:</label>   <input type="text" id="id" name="id" value="'+(n=(o=t=g,{id:o.find(".id").text(),json:o.find(".json").text(),response:o.find(".response").text(),success:o.find(".success").text(),ds_error:o.find(".ds_error").text(),is_successful:o.find(".is_sucessful").text()})).id+'" readonly></div><div class="form-group">   <label for="json">JSON:</label>   <textarea id="json" name="json" rows="40" cols="50">'+f(n.json)+'</textarea></div><div class="form-group">   <label for="response">Response:</label>   <textarea id="response" name="response" rows="4" cols="50" readonly>'+n.response+'</textarea></div><div class="form-group">   <label for="success">Success:</label>   <input type="text" id="success" name="success" value="'+n.success+'" readonly></div><div class="form-group">   <label for="ds_error">DS Error:</label>   <input type="text" id="ds_error" name="ds_error" value="'+n.ds_error+'" readonly></div><div class="form-group">   <label for="is_successful">Is Successful:</label>   <input type="text" id="is_successful" name="is_successful" value="'+n.is_successful+'" readonly></div></form>',large:!0};a.create(v).then(function(s){e(s.footer).on("click",".btn.btn-primary",function(){var o=e(l).serializeArray();document.getElementById("overlay").style.display="flex",r.call([{methodname:"local_uplannerconnect_edit_log",args:{data:JSON.stringify(o)}}])[0].fail(function(r){m(),p(r.message),s.show();setTimeout(function(){e(d).hide()},4e3)}).then(function(r){var o,t,a,n,i,y;(m(),r.done)?(o=r.message,e(d).hasClass(u)&&e(d).removeClass(u),e(d).hasClass(c)||e(d).addClass(c),e(d).text(o),e(d).show(),s.show(),setTimeout(function(){s.destroy(),location.reload()},500),location.reload()):(t=g,a=JSON.parse(r.data),n=e(l),i=JSON.parse(a.json),y=JSON.parse(a.response),t.find(".json").text(JSON.stringify(i)),t.find(".response").text(JSON.stringify(y)),t.find(".ds_error").text(a.ds_error),t.find(".is_sucessful").text(a.is_sucessful),n.find("#json").val(f(a.json)).trigger("change"),n.find("#response").val(f(a.response)).trigger("change"),n.find("#ds_error").val(a.ds_error).trigger("change"),n.find("#is_sucessful").val(a.is_sucessful).trigger("change"),p(r.message),s.show())})}),s.show()})}return{init:function s(r){l+=i=r,e(document).on("click",".error-summary-table .actions-edit",g)}}});