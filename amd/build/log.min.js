define(["jquery","core/log","core/ajax","core/templates","core/str","core/modal_factory","core/modal_events"],function(e,r,s,o,t,a,n){"use strict";var l="#form-",i="",d="#form-alert",c="alert-success",u="alert-danger";function f(e){try{var r=JSON.parse(e);return JSON.stringify(r,null,2)}catch(s){return e}}function p(r){e(d).hasClass(c)&&e(d).removeClass(c),e(d).hasClass(u)||e(d).addClass(u),e(d).text(r),e(d).show()}function m(r){setTimeout(function(){e(d).hide()},r)}function y(){document.getElementById("overlay").style.display="none"}function g(r){var o,t,n,m=e(r.target).parents(".error-summary-tr"),g=m.find(".id").text(),v={type:a.types.SAVE_CANCEL,title:"Edit uPlanner log "+g,body:'<style>.form-group { margin-bottom: 15px; }label { display: inline-block; margin-bottom: 5px; }textarea, input[type="text"] { width: 100%; padding: 8px; box-sizing: border-box; }#form-alert { display: none; }.alert { position: relative; padding: .75rem 1.25rem; margin-bottom: 1rem; border: 1px solid transparent; border-radius: .25rem;.alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }.alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }</style><div id="form-alert" class="alert" role="alert"></div><form id="form-'+i+'">   <input type="hidden" id="type" name="type" value="'+i+'" readonly><div class="form-group">   <label for="id">Id:</label>   <input type="text" id="id" name="id" value="'+(n=(o=t=m,{id:o.find(".id").text(),json:o.find(".json").text(),response:o.find(".response").text(),success:o.find(".success").text(),ds_error:o.find(".ds_error").text(),is_successful:o.find(".is_sucessful").text()})).id+'" readonly></div><div class="form-group">   <label for="json">JSON:</label>   <textarea id="json" name="json" rows="40" cols="50">'+f(n.json)+'</textarea></div><div class="form-group">   <label for="response">Response:</label>   <textarea id="response" name="response" rows="4" cols="50" readonly>'+n.response+'</textarea></div><div class="form-group">   <label for="success">Success:</label>   <input type="text" id="success" name="success" value="'+n.success+'" readonly></div><div class="form-group">   <label for="ds_error">DS Error:</label>   <input type="text" id="ds_error" name="ds_error" value="'+n.ds_error+'" readonly></div><div class="form-group">   <label for="is_successful">Is Successful:</label>   <input type="text" id="is_successful" name="is_successful" value="'+n.is_successful+'" readonly></div></form>',large:!0};a.create(v).then(function(r){e(r.footer).on("click",".btn.btn-primary",function(){var o,t,a,n=e(l).serializeArray();if(document.getElementById("overlay").style.display="flex",t=(o=e(l)).find("#json").val(),(a=o.find("#id").val(),/^\d+$/.test(a))?!function e(r){try{var s=JSON.parse(r);return"object"==typeof s&&null!==s}catch(o){return!1}}(t)?(p("El campo JSON debe ser un JSON v\xe1lido."),1):0:(p("El campo Id debe ser un n\xfamero entero."),1))setTimeout(function(){y(),r.show()},1e3);else s.call([{methodname:"local_uplannerconnect_edit_log",args:{data:JSON.stringify(n)}}])[0].fail(function(e){y(),p(e.message),r.show()}).done(function(s){if(y(),s.done){var o;o=s.message,e(d).hasClass(u)&&e(d).removeClass(u),e(d).hasClass(c)||e(d).addClass(c),e(d).text(o),e(d).show(),r.show(),setTimeout(function(){r.destroy(),location.reload()},4e3)}else(function r(s,o){try{var t=e(l),a=JSON.parse(o.data),n=JSON.parse(a.response);s.find(".response").text(JSON.stringify(n)),s.find(".ds_error").text(a.ds_error),s.find(".is_sucessful").text(a.is_sucessful),t.find("#response").val(f(a.response)).trigger("change"),t.find("#ds_error").val(a.ds_error).trigger("change"),t.find("#is_sucessful").val(a.is_sucessful).trigger("change")}catch(i){return!1}})(m,s.data),p(s.message),r.show()})}),r.show()})}return{init:function r(s){l+=i=s,e(document).on("click",".error-summary-table .actions-edit",g)}}});